import pandas as pd
import numpy as np
from sklearn.cluster import KMeans
from sklearn.preprocessing import MinMaxScaler
from sklearn.ensemble import IsolationForest
import matplotlib.pyplot as plt


data = pd.read_excel('dataset.xlsx')
scaler = MinMaxScaler()
dataset = pd.DataFrame(scaler.fit_transform(data), columns=data.columns) 

# Isolation Forest model
iForest = IsolationForest(n_estimators=100, max_samples='auto', contamination='auto', random_state=40)
iForest.fit(dataset)

# Anomaly scores for each observation
scores = iForest.decision_function(dataset)

# Defining the anomaly threshold, and finding anomalous observations
umbral=-0.06
anomaly=dataset[scores < umbral]

# Results
print("Number of anomalies detected:", len(anomaly))

# Anomalies index
anomaly_index=anomaly.index
print(anomaly_index)

# Forma 2
anomaly_index_1 = np.where(scores < umbral)[0]
print(anomaly_index_1)

# Histogram of Decision Scores
plt.hist(scores, bins=70)
plt.xlabel('Decision Scoring')
plt.ylabel('Frequency')
plt.title('Histogram of Decision Scores')
plt.show()
